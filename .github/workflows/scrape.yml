name: Daily K-POP Schedule Scraping

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œ(UTC+0)ì— ì‹¤í–‰ = í•œêµ­ ì‹œê°„ ì˜¤í›„ 6ì‹œ
    - cron: '0 9 * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ ì˜µì…˜
  workflow_dispatch:

jobs:
  scrape-schedule:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ë¦¬í¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # 2. Python ì„¤ì •
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright
          playwright install chromium

      # 4. ìŠ¤í¬ë˜í•‘ ì‹¤í–‰
      - name: Run scraper
        run: python scraper.py

      # 5. ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # schedule.jsonì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
          if git diff --quiet schedule.json; then
            echo "âœ… ë³€ê²½ì‚¬í•­ ì—†ìŒ (ë°ì´í„°ê°€ ë™ì¼í•¨)"
          else
            echo "ğŸ“ schedule.json ì—…ë°ì´íŠ¸ ê°ì§€"
            git add schedule.json
            git commit -m "chore: update K-POP schedule data [automated]"
            git push
          fi

      # 6. ì‹¤íŒ¨ ì•Œë¦¼ (ì„ íƒì‚¬í•­)
      - name: Handle failure
        if: failure()
        run: |
          echo "âŒ ìŠ¤í¬ë˜í•‘ ì‹¤íŒ¨"
          echo "GitHub Actions ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”"
