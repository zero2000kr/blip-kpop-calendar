<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-POP ìŠ¤ì¼€ì¤„ ìº˜ë¦°ë”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* í—¤ë” */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            opacity: 0.9;
            font-size: 1em;
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            padding: 30px;
        }

        /* ìº˜ë¦°ë” ì„¹ì…˜ */
        .calendar-section h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #333;
        }

        .month-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .month-nav button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        .month-nav button:hover {
            background: #764ba2;
        }

        .month-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        /* ìº˜ë¦°ë” ê·¸ë¦¬ë“œ */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e0e0e0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .weekday {
            background: #667eea;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .calendar-day {
            background: white;
            min-height: 120px;
            padding: 10px;
            border-right: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        .calendar-day:hover {
            background: #f9f9f9;
        }

        .calendar-day.empty {
            background: #f5f5f5;
        }

        .calendar-day.today {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .day-number {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .event-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }

        .event-label {
            font-size: 0.75em;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: flex;
            align-items: center;
        }

        /* í•„í„° ì‚¬ì´ë“œë°” */
        .sidebar {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .sidebar h3 {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #333;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group label {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            font-size: 0.95em;
            color: #555;
            transition: color 0.2s;
        }

        .filter-group label:hover {
            color: #667eea;
        }

        .filter-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .category-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        /* ìƒì„¸ ì •ë³´ ì„¹ì…˜ */
        .details-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin-top: 20px;
        }

        .details-section h3 {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #333;
        }

        .event-detail {
            background: white;
            padding: 15px;
            border-left: 4px solid #667eea;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .event-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .event-meta {
            font-size: 0.85em;
            color: #999;
            margin-bottom: 5px;
        }

        .event-artist {
            font-size: 0.9em;
            color: #667eea;
            font-weight: 500;
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1024px) {
            .main {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 2em;
            }

            .calendar-day {
                min-height: 80px;
            }
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .main {
                padding: 15px;
                gap: 15px;
            }

            .calendar-day {
                min-height: 60px;
                font-size: 0.85em;
            }

            .event-label {
                font-size: 0.7em;
            }

            header h1 {
                font-size: 1.5em;
            }
        }

        /* ì—…ë°ì´íŠ¸ ì‹œê°„ */
        .update-time {
            font-size: 0.8em;
            color: #999;
            margin-top: 20px;
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸµ K-POP ìŠ¤ì¼€ì¤„ ìº˜ë¦°ë”</h1>
            <p>blip.krì˜ ì¼€ì´íŒ ì¼ì •ì„ í•œ ëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
        </header>

        <div class="main">
            <div class="calendar-section">
                <div class="month-nav">
                    <button id="prevBtn">â† ì´ì „</button>
                    <div class="month-display" id="monthDisplay">2026. 2</div>
                    <button id="nextBtn">ë‹¤ìŒ â†’</button>
                </div>
                <div class="calendar" id="calendar"></div>

                <div class="details-section">
                    <h3 id="selectedDateTitle">ì„ íƒëœ ë‚ ì§œì˜ ì¼ì •</h3>
                    <div id="eventDetails">
                        <p style="color: #999; text-align: center;">ë‚ ì§œë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
                    </div>
                </div>
            </div>

            <aside class="sidebar">
                <h3>í•„í„°</h3>
                
                <div class="filter-group">
                    <h4 style="font-size: 0.95em; margin-bottom: 10px; color: #666;">ì¼ì • ìœ í˜•</h4>
                    <div id="categoryFilters"></div>
                </div>

                <button style="width: 100%; padding: 10px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-bottom: 20px;" onclick="resetFilters()">
                    í•„í„° ì´ˆê¸°í™”
                </button>

                <div class="update-time" id="updateTime"></div>
            </aside>
        </div>
    </div>

    <script>
        // ê¸€ë¡œë²Œ ìƒíƒœ
        let scheduleData = null;
        let currentDate = new Date();
        let selectedDate = null;
        let activeFilters = new Set();

        // ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ
        const CATEGORY_COLORS = {
            "ì¶•í•˜": "#4ECDC4",
            "ë°œë§¤": "#FF6B6B",
            "ë°©ì†¡": "#FFE66D",
            "êµ¬ë§¤": "#95E1D3",
            "í–‰ì‚¬": "#C7CEEA",
            "ê¸°íƒ€": "#999999",
            "ë¹„ê³µì‹": "#FFB6B9",
            "SNS": "#8EC5FC"
        };

        /**
         * schedule.json ë¡œë“œ
         */
        async function loadScheduleData() {
            try {
                const response = await fetch('./schedule.json');
                if (!response.ok) throw new Error('schedule.jsonì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                
                scheduleData = await response.json();
                console.log('âœ… ìŠ¤ì¼€ì¤„ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', scheduleData);
                
                initializeFilters();
                renderCalendar();
                updateTimeDisplay();
            } catch (error) {
                console.error('âŒ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('calendar').innerHTML = `
                    <div class="loading" style="grid-column: 1/-1;">
                        <p>âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">ìƒˆë¡œê³ ì¹¨ì„ ì‹œë„í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì ‘ì†í•´ì£¼ì„¸ìš”.</p>
                    </div>
                `;
            }
        }

        /**
         * í•„í„° ì´ˆê¸°í™” ë° ë Œë”ë§
         */
        function initializeFilters() {
            const filterContainer = document.getElementById('categoryFilters');
            filterContainer.innerHTML = '';

            if (scheduleData && scheduleData.categories) {
                scheduleData.categories.forEach(category => {
                    const label = document.createElement('label');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = true;
                    checkbox.value = category;

                    checkbox.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            activeFilters.delete(category);
                        } else {
                            activeFilters.add(category);
                        }
                        renderCalendar();
                    });

                    const color = document.createElement('span');
                    color.className = 'category-indicator';
                    color.style.backgroundColor = CATEGORY_COLORS[category] || '#999';

                    label.appendChild(checkbox);
                    label.appendChild(color);
                    label.appendChild(document.createTextNode(category));
                    
                    filterContainer.appendChild(label);
                });
            }
        }

        /**
         * í•„í„° ì´ˆê¸°í™” ë²„íŠ¼
         */
        function resetFilters() {
            activeFilters.clear();
            document.querySelectorAll('#categoryFilters input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
            renderCalendar();
        }

        /**
         * ìº˜ë¦°ë” ë Œë”ë§
         */
        function renderCalendar() {
            if (!scheduleData) return;

            const calendar = document.getElementById('calendar');
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            // ì›” í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('monthDisplay').textContent = 
                `${year}. ${String(month + 1).padStart(2, '0')}`;

            // ìº˜ë¦°ë” ì´ˆê¸°í™”
            calendar.innerHTML = '';

            // ìš”ì¼ í—¤ë”
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            weekdays.forEach(day => {
                const weekdayEl = document.createElement('div');
                weekdayEl.className = 'weekday';
                weekdayEl.textContent = day;
                calendar.appendChild(weekdayEl);
            });

            // ì²« ë‚ ì§œì™€ ë§ˆì§€ë§‰ ë‚ ì§œ ê³„ì‚°
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

            // ë¹ˆ ì…€ ì¶”ê°€
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendar.appendChild(emptyDay);
            }

            // ë‚ ì§œ ì…€ ì¶”ê°€
            for (let date = 1; date <= lastDate; date++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';

                if (isCurrentMonth && date === today.getDate()) {
                    dayEl.classList.add('today');
                }

                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = date;

                const eventsEl = document.createElement('div');
                eventsEl.className = 'day-events';

                // í•´ë‹¹ ë‚ ì§œì˜ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (í•„í„° ì ìš©)
                const dayEvents = scheduleData.calendar[String(date)] || [];
                const filteredEvents = dayEvents.filter(event => {
                    return !activeFilters.has(event.category);
                });

                filteredEvents.forEach(event => {
                    const eventLabel = document.createElement('div');
                    eventLabel.className = 'event-label';
                    
                    const dot = document.createElement('span');
                    dot.className = 'event-dot';
                    dot.style.backgroundColor = CATEGORY_COLORS[event.category] || '#999';
                    
                    const text = document.createElement('span');
                    text.textContent = event.category;
                    
                    eventLabel.appendChild(dot);
                    eventLabel.appendChild(text);
                    eventsEl.appendChild(eventLabel);
                });

                dayEl.appendChild(dayNumber);
                dayEl.appendChild(eventsEl);

                // í´ë¦­ ì´ë²¤íŠ¸
                dayEl.addEventListener('click', () => {
                    selectedDate = date;
                    showEventDetails(date, dayEvents);
                    updateSelectedHighlight();
                });

                calendar.appendChild(dayEl);
            }
        }

        /**
         * ì„ íƒëœ ë‚ ì§œ í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
         */
        function updateSelectedHighlight() {
            document.querySelectorAll('.calendar-day').forEach((day, idx) => {
                day.style.borderWidth = '1px';
            });

            if (selectedDate !== null) {
                const offset = 7 + (new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay());
                const selectedElement = document.querySelectorAll('.calendar-day')[offset + selectedDate - 1];
                if (selectedElement) {
                    selectedElement.style.borderWidth = '2px';
                    selectedElement.style.borderColor = '#667eea';
                }
            }
        }

        /**
         * ë‚ ì§œ ì„ íƒ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
         */
        function showEventDetails(date, events) {
            const title = document.getElementById('selectedDateTitle');
            const details = document.getElementById('eventDetails');

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            title.textContent = `${year}ë…„ ${month}ì›” ${date}ì¼ì˜ ì¼ì •`;

            if (!events || events.length === 0) {
                details.innerHTML = '<p style="color: #999; text-align: center;">ì´ ë‚ ì§œì— ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            details.innerHTML = events
                .filter(event => !activeFilters.has(event.category))
                .map(event => `
                    <div class="event-detail">
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <span class="event-dot" style="background-color: ${CATEGORY_COLORS[event.category] || '#999'}"></span>
                            <span style="font-size: 0.8em; color: #999; font-weight: 500;">${event.category}</span>
                        </div>
                        <div class="event-title">${event.title}</div>
                    </div>
                `)
                .join('');
        }

        /**
         * ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
         */
        function updateTimeDisplay() {
            if (scheduleData && scheduleData.updated_at) {
                const date = new Date(scheduleData.updated_at);
                const formatted = date.toLocaleString('ko-KR');
                document.getElementById('updateTime').innerHTML = 
                    `<strong>ë§ˆì§€ë§‰ ê°±ì‹ :</strong><br>${formatted}`;
            }
        }

        /**
         * ì›” ë„¤ë¹„ê²Œì´ì…˜
         */
        document.getElementById('prevBtn').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            selectedDate = null;
            renderCalendar();
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            selectedDate = null;
            renderCalendar();
        });

        /**
         * ì´ˆê¸°í™” ë° ì‹¤í–‰
         */
        window.addEventListener('load', () => {
            loadScheduleData();
        });
    </script>
</body>
</html>
