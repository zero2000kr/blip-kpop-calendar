name: Daily K-POP Schedule Scraping

on:
  schedule:
    # í•œêµ­ ì‹œê°„ ì˜¤ì „ 1ì‹œ (UTC 16:00 ì „ì¼)
    - cron: '0 16 * * *'
    # í•œêµ­ ì‹œê°„ ì˜¤í›„ 1ì‹œ (UTC 04:00)
    - cron: '0 4 * * *'
    # í•œêµ­ ì‹œê°„ ì˜¤í›„ 7ì‹œ (UTC 10:00)
    - cron: '0 10 * * *'

  # ìˆ˜ë™ ì‹¤í–‰
  workflow_dispatch:

jobs:
  scrape-schedule:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Run scraper
        run: python scraper.py

      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"

          # schedule.json ì¡´ì¬ ì—¬ë¶€ì™€ ë³€ê²½ ì—¬ë¶€ í™•ì¸
          if [ ! -f schedule.json ]; then
            echo "âŒ schedule.jsonì´ ìƒì„±ë˜ì§€ ì•ŠìŒ"
            exit 1
          fi

          # ì‹ ê·œ íŒŒì¼ì´ê±°ë‚˜ ë³€ê²½ëœ ê²½ìš° ì»¤ë°‹
          git add schedule.json
          if git diff --cached --quiet; then
            echo "âœ… ë³€ê²½ì‚¬í•­ ì—†ìŒ (ë°ì´í„° ë™ì¼)"
          else
            echo "ğŸ“ schedule.json ì—…ë°ì´íŠ¸ ê°ì§€"
            git commit -m "chore: update K-POP schedule data [automated]"
            git push
          fi
