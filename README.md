# blip-kpop-calendar

blip.kr의 K-POP 스케줄 데이터를 스크래핑하여 정적 캘린더로 제공하는 프로젝트.

## 주요 기능

- 🎯 **그룹별 필터링**: 실시간 검색으로 원하는 그룹만 선택하여 일정 확인
- 🏷️ **카테고리 분류**: 발매, 프리오더, 방송, 행사 등 9개 카테고리 자동 분류
- 🔄 **스마트 캐싱**: 자동 버전 관리로 항상 최신 데이터 제공
- 🔗 **구글 검색 연동**: 이벤트 클릭 시 관련 정보 즉시 검색
- 📱 **반응형 디자인**: 모바일/태블릿/데스크톱 모두 최적화
- 🌙 **프리미엄 다크 모드**: 현대적이고 세련된 UI

## 파일 구조

```text
scraper.py      # 데이터 수집 (Python 3, 표준 라이브러리만 사용)
index.html      # 캘린더 UI (단일 파일, 프레임워크 없음)
schedule.json   # scraper가 생성하는 데이터 파일
```

## 실행

```bash
python3 scraper.py        # → schedule.json 생성
# index.html을 브라우저에서 열면 schedule.json을 fetch하여 렌더링
```

GitHub Actions로 하루 1회 자동 실행 권장. schedule.json을 커밋하면 GitHub Pages로 배포 가능.

## 데이터 소스

blip.kr은 Next.js App Router(SSR) 기반이며, HTML 테이블에는 셀당 최대 3개 이벤트만 표시된다.
전체 데이터는 **RSC(React Server Component) payload**(`self.__next_f.push`)에 JSON으로 포함되어 있어,
이 payload를 파싱하는 방식으로 전체 이벤트를 수집한다.

---

## 설계 의사결정 기록

### 스크래핑 방식: RSC payload 파싱 (v3에서 전환)

**문제**: blip.kr의 SSR HTML 테이블은 셀당 3개만 렌더링하여 대량 누락 발생.

**대안 검토**:
- HTML 테이블 파싱 → 셀당 3개 제한으로 불완전
- 내부 API 직접 호출 → 엔드포인트 비공개, 변경 위험 높음

**결정**: RSC payload 파싱. 페이지 HTML에 포함된 전체 데이터를 추출하므로 누락 없고,
일반 페이지 요청과 동일하여 API 의존성 없음.

---

### 그룹 필터: unitId 기반 (members 대신)

**분석 결과** (3개월, 656 이벤트):

| 필드 | 전체 커버리지 | 발매(typeId=2) 커버리지 | 축하(typeId=4) 커버리지 |
|------|-------------|----------------------|----------------------|
| unitId | 100% (656/656) | 100% | 100% |
| members (artistId) | 50.2% (329/656) | 21.5% | 60.3% |

**결정**: unitId 사용. members는 발매 이벤트의 79%에서 누락되어 필터링 시 대부분의 컴백/발매 일정이 사라지는 치명적 문제가 있음.

**트레이드오프**: unitId는 그룹 단위만 식별 가능하고 개별 멤버 필터링은 불가. 다만 사용 목적(마케팅팀 일정 조회)상 그룹 단위가 적절.

---

### 유닛 매핑: 동적 수집 (정적 내장 대신)

blip.kr 홈페이지 RSC payload에 `unitId → 그룹명(한글/영문)` 매핑이 포함되어 있음.
스크래핑 시 홈페이지를 먼저 1회 요청하여 이 매핑을 동적으로 추출.

**대안**: scraper.py에 매핑을 하드코딩
**결정**: 동적 수집. 신규 그룹 추가 시 자동 대응되며, 요청 1회 추가는 하루 총 5-8회 수준으로 부담 없음.

**매핑되지 않는 unitId** (2025.02 기준 2개: 119, 164):
홈페이지 그룹 목록에 미등록된 신규/소규모 그룹. schedule.json에서 `"기타 그룹"`으로 표시.

---

### 카테고리 분류: typeId + 키워드 이중 체계

blip.kr의 `typeId`는 2(발매)와 4(축하) 두 가지만 존재. 방송, 행사, 구매, SNS 등은 구분되지 않음.

**결정**: typeId를 기본 분류로 사용하되, 제목 키워드 매칭으로 세부 카테고리 보정.
키워드 매칭이 typeId보다 우선 적용됨 (예: typeId=2이지만 제목에 "콘서트" 포함 → "행사"로 분류).

---

### 시간대 처리

blip.kr의 `startTime`은 UTC(`"2026-01-31T15:00:00.000Z"`)로 제공됨.
KST(+9시간)로 변환하여 날짜를 결정하므로, UTC 기준 1월 31일 15:00은 KST 2월 1일로 배치됨.

---

### 이벤트 상세 링크: 구글 검색 (blip.kr 직접 링크 대신)

**문제**: 캘린더 세부 스케줄 항목에 클릭 가능한 상세 링크가 없어, 관련 정보를 보려면 별도로 검색해야 함.

**대안 검토**:
- blip.kr 상세 페이지(`/schedule/{scheduleId}`) → URL은 존재하나 접속 시 콘텐츠 미표시 (로그인/앱 전용 추정)
- 구글 검색 링크 → 관련 뉴스, MV, SNS 게시물 등 실제 유용한 정보에 바로 접근 가능

**결정**: 구글 검색 링크. 쿼리는 `영문 그룹명 + 이벤트 제목` 조합.
이벤트 제목이 대부분 영문이므로 영문 그룹명과의 조합이 검색 정확도가 높음.

**구현**: scheduleId는 JSON에 포함하지 않음 (링크 생성에 불필요). 검색 URL은 index.html에서 units 매핑의 영문명을 참조하여 클라이언트 사이드에서 생성.

---

### 스마트 캐싱: updated_at 기반 버전 관리

**문제**: 브라우저 캐시로 인해 사용자가 최신 스케줄을 보지 못하는 문제 발생.

**대안 검토**:
- 타임스탬프 쿼리 파라미터(`?v=123456`) → 매 요청마다 새 캐시 생성, 비효율적
- `cache: 'no-store'` → 캐시 완전 비활성화, 네트워크 낭비
- `cache: 'no-cache'` + localStorage 버전 체크 → 서버 검증 후 304 응답 활용

**결정**: `updated_at` 필드를 버전으로 사용하는 스마트 캐싱.

**작동 방식**:
1. 페이지 로드 시 `cache: 'no-cache'`로 schedule.json 요청
2. 서버가 파일 변경 여부 확인 후 304(Not Modified) 또는 200(새 데이터) 응답
3. `updated_at` 값을 localStorage에 저장하여 버전 추적
4. 콘솔에 버전 체크 로그 출력 (디버깅 용이)

**장점**: 
- 데이터가 변경되지 않았으면 브라우저 캐시 활용 (빠름)
- 실제 업데이트 시에만 새 데이터 다운로드 (정확함)
- 불필요한 캐시 항목 생성 없음 (효율적)

---

### UI 개선: 카테고리 필터 기본값

**문제**: 모든 카테고리가 기본 활성화되어 있어 캘린더가 너무 복잡하고 정보 과부하 발생.

**결정**: 초기 로드 시 **발매**와 **프리오더** 카테고리만 활성화.

**근거**: 
- 마케팅팀의 주요 관심사는 앨범/싱글 발매 일정
- 사용자가 필요에 따라 다른 카테고리(방송, 행사 등)를 클릭하여 추가 가능
- 깔끔한 초기 화면으로 사용성 향상

---

### UI 개선: 그룹 검색 및 다중 선택

**기능**:
- 검색창에서 그룹명(한글/영문) 실시간 검색
- 여러 그룹을 동시에 선택하여 필터링 가능
- 선택된 그룹은 태그 형태로 표시되며 개별 제거 가능
- 그룹 목록은 이벤트 수 기준 내림차순 정렬 (인기 그룹 우선 표시)

**구현**:
- 드롭다운에 각 그룹의 이벤트 수 표시
- 이미 선택된 그룹은 드롭다운에서 제외
- 검색창 외부 클릭 시 드롭다운 자동 닫힘
- "전체 해제" 버튼으로 한 번에 필터 초기화

---

## 알려진 제한사항

- **blip.kr 구조 변경 시 파싱 실패 가능**: RSC payload 형식이 바뀌면 정규식 수정 필요
- **카테고리 분류 한계**: 키워드 사전에 없는 새로운 형식의 제목은 `기타`로 분류됨
- **schedule.json 크기**: 14개월 수집 기준 ~165KB. 수집 범위 확장 시 증가

## 고도화 후보 (실사용자 피드백 후)

- **모바일 터치 제스처**: 스와이프로 월 이동
- **그룹별 컬러 구분**: 선택된 그룹마다 다른 색상 적용
- **이벤트 알림 기능**: 관심 그룹의 발매일 알림
- **라이트 모드**: 현재 다크 모드만 지원, 라이트 테마 추가
- **캘린더 내보내기**: iCal/Google Calendar 형식으로 내보내기
- **URL 공유**: 특정 그룹/카테고리 필터 상태를 URL로 공유
- **통계 대시보드**: 월별/그룹별 이벤트 통계 시각화

## 구현 완료 기능

- ✅ **그룹 검색 및 다중 선택**: 실시간 검색, 여러 그룹 동시 필터링
- ✅ **카테고리 필터**: 9개 카테고리 토글 (기본값: 발매, 프리오더)
- ✅ **스마트 캐싱**: updated_at 기반 자동 버전 관리
- ✅ **구글 검색 연동**: 이벤트 클릭 시 관련 정보 검색
- ✅ **반응형 디자인**: 모바일/태블릿/데스크톱 최적화
- ✅ **다크 모드**: 프리미엄 다크 테마 적용

